from aiogram import Router, F
from aiogram.filters import Command, CommandStart
from aiogram.types import Message, CallbackQuery

from app.bot.keyboards.inline import get_main_menu_keyboard
from app.services.user_service import UserService

start_router = Router()


@start_router.message(CommandStart())
async def start_handler(message: Message, user: any = None, user_service: UserService = None):
    """Handler for /start command."""
    
    welcome_text = (
        f"üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π!\n\n"
        f"üëã –ü—Ä–∏–≤–µ—Ç, {message.from_user.first_name or '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å'}!\n\n"
        f"üéØ –ù–∞—à –±–æ—Ç –ø–æ–º–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–∞—à–∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö:\n"
        f"‚Ä¢ üé® –•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞\n"
        f"‚Ä¢ üíº –ë–∏–∑–Ω–µ—Å-–æ–±—Ä–∞–±–æ—Ç–∫–∞\n" 
        f"‚Ä¢ üî¢ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ü–∏—Ñ—Ä –∏ –¥–∞–Ω–Ω—ã—Ö\n\n"
        f"üí∞ –£ –≤–∞—Å –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏!\n"
        f"üí≥ –î–ª—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ø–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å.\n\n"
        f"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    )
    
    await message.answer(
        welcome_text,
        reply_markup=get_main_menu_keyboard()
    )


@start_router.callback_query(F.data == "back_to_main")
async def back_to_main_handler(callback: CallbackQuery):
    """Return to main menu."""
    
    main_text = (
        "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n\n"
        "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    )
    
    await callback.message.edit_text(
        main_text,
        reply_markup=get_main_menu_keyboard()
    )
    await callback.answer()


@start_router.message(Command("help"))
async def help_handler(message: Message):
    """Handler for /help command."""
    
    help_text = (
        "‚ÑπÔ∏è <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞</b>\n\n"
        
        "üéØ <b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å:</b>\n"
        "1. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å¬ª\n"
        "2. –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏\n"
        "3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é\n"
        "4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
        "5. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–æ 1 –º–∏–Ω—É—Ç—ã)\n"
        "6. –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n\n"
        
        "üí∞ <b>–°–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã:</b>\n"
        f"‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: {10.0} ‚ÇΩ\n"
        "‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏\n"
        "‚Ä¢ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ YooMoney –∏–ª–∏ Telegram Stars\n\n"
        
        "üé® <b>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</b>\n"
        "‚Ä¢ <b>–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è:</b> –¥–∏–∞–ª–æ–≥–∏, –ø—Ä–∏—Ä–æ–¥–∞, –º—É–∑—ã–∫–∞, –ø–æ—ç–∑–∏—è\n"
        "‚Ä¢ <b>–ë–∏–∑–Ω–µ—Å:</b> –¥–æ–≥–æ–≤–æ—Ä—ã, –∑–∞–∫–æ–Ω—ã, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã\n"
        "‚Ä¢ <b>–¶–∏—Ñ—Ä—ã:</b> –º–∞—Ä—à—Ä—É—Ç—ã, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —Ä–∞—Å—á—ë—Ç—ã\n\n"
        
        "üìû <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b>\n"
        "–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
    )
    
    await message.answer(help_text)


@start_router.callback_query(F.data == "help")
async def help_callback_handler(callback: CallbackQuery):
    """Help callback handler."""
    
    help_text = (
        "‚ÑπÔ∏è <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞</b>\n\n"
        
        "üéØ <b>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å:</b>\n"
        "1. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å¬ª\n"
        "2. –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏\n"
        "3. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é\n"
        "4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
        "5. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–¥–æ 1 –º–∏–Ω—É—Ç—ã)\n"
        "6. –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç\n\n"
        
        "üí∞ <b>–°–∏—Å—Ç–µ–º–∞ –æ–ø–ª–∞—Ç—ã:</b>\n"
        f"‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞: {10.0} ‚ÇΩ\n"
        "‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏\n"
        "‚Ä¢ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ YooMoney –∏–ª–∏ Telegram Stars\n\n"
        
        "üé® <b>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</b>\n"
        "‚Ä¢ <b>–•—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è:</b> –¥–∏–∞–ª–æ–≥–∏, –ø—Ä–∏—Ä–æ–¥–∞, –º—É–∑—ã–∫–∞, –ø–æ—ç–∑–∏—è\n"
        "‚Ä¢ <b>–ë–∏–∑–Ω–µ—Å:</b> –¥–æ–≥–æ–≤–æ—Ä—ã, –∑–∞–∫–æ–Ω—ã, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏, –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã\n"
        "‚Ä¢ <b>–¶–∏—Ñ—Ä—ã:</b> –º–∞—Ä—à—Ä—É—Ç—ã, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —Ä–∞—Å—á—ë—Ç—ã\n\n"
        
        "üìû <b>–ü–æ–¥–¥–µ—Ä–∂–∫–∞:</b>\n"
        "–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É."
    )
    
    await callback.message.edit_text(help_text, reply_markup=get_main_menu_keyboard())
    await callback.answer()